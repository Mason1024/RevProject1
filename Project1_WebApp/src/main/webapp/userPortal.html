<!DOCTYPE html>
<meta charset="utf-8"/>
<html>
    <head>

        <title>Miner's Portal</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">   
        <link rel="stylesheet" href="LOTR.css" type="text/css" charset="utf-8" />
        <style>
            .container{
                display:flex;
                flex-wrap:wrap;
            }
        </style>

    </head>
    <body>
        <div id="topBar" class="container" style="margin-top: 10px">
            <table width=100%>
                <tr>
                    <td><h3>Miner's Portal</h3></td>
                    <td>
                        <table>
                            <tr>
                                <td colspan="3">Submit a reinbursement</td>
                                
                            </tr>
                            <tr>
                                <td>Amount</td>
                                <td><input id="inputAmount" type="text"></td>
                                <td>
                                    <button id="submitBtn">Submit</button>
                                </td>
                            </tr>
                            <tr>
                                <td>Description</td>
                                <td><input id="inputDesc" type="text"></td>
                                <td>
                                    <button id="clearBtn">Clear</button>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </div>
        <div id="mainArea" class="container">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Description</th>
                        <th>Amount</th>
                        <th>Submitted On</th>
                        <th>Status</th>
                        <th>Proccessed By</th>
                        <th>Comments</th>
                    </tr>
                </thead>
                <tbody id="itemsTable">
                    <tr>
                        <td>1</td>
                        <td>bought candy</td>
                        <td>1.00</td>
                        <td>12:00pm 10/3/2019</td>
                        <td>pending</td>
                        <td> </td>
                        <td> </td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>bought candy</td>
                        <td>1.00</td>
                        <td>12:00pm 10/4/2019</td>
                        <td>pending</td>
                        <td> </td>
                        <td> </td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>bought candy</td>
                        <td>1.00</td>
                        <td>12:00pm 10/5/2019</td>
                        <td>pending</td>
                        <td> </td>
                        <td> </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </body>
    <script>
        let table = document.getElementById('itemsTable'); 
        
        //clear
        document.getElementById("clearBtn").addEventListener("click",()=>{
            document.getElementById("inputAmount").value="";
            document.getElementById("inputDesc").value="";
        })

        //submit
        document.getElementById("submitBtn").addEventListener("click",()=>{
            let a = document.getElementById("inputAmount").value;
            let d = document.getElementById("inputDesc").value;
            a = parseFloat(a);

            // //throw to JAVA to create new reinbursement
            let xhttp = new XMLHttpRequest();

            xhttp.onreadystatechange = function(){
                if(this.readyState === 4 && this.status === 200){
                    if(this.responseText){
                        addRow(this.responseText);
                    }
                }
            }
            xhttp.open("post", "http://localhost:8080/Project1_WebApp/openReimbursement.do", true);
            xhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
            xhttp.send(`description=${d}&amount=${a}`);
        })

        let populate = function(){
            let xhttp = new XMLHttpRequest();

            xhttp.onreadystatechange = function(){
                if(this.readyState === 4 && this.status === 200){
                    if(this.responseText){
                        addRow(this.responseText);
                    }
                }
            }
            xhttp.open("get", "http://localhost:8080/Project1_WebApp/openReimbursement.do", true);
            xhttp.send();
        }

        function addRow(dataJSON){

            let data = JSON.parse(dataJSON);

            let string = `<tr>`;
                string+= `<td>${data.id}</td>`;
                string+= `<td>${data.description}</td>`;
                string+= `<td>${data.amount}</td>`;
                string+= `<td>${data.timestamp}</td>`;
                if(data.status===1){
                    string+= `<td>Approved</td>`;
                }else if(data.status===2){
                    string+= `<td>Rejected</td>`;
                }else{
                    string+= `<td>Pending</td>`;
                }
                string+= `<td>${data.approver}</td>`;
                string+= `<td>${data.comment}</td>`;
                string+= `</tr>`;
            table.innerHTML+=string;
        }

        let o={
            id:5,
            submitter:"Steve",
            approver:"",
            description:"stuff",
            amount:20.00,
            timestamp:"3:00pm 10/6/2019",
            comment:"",
            status:0,
        }
    </script>
</html>