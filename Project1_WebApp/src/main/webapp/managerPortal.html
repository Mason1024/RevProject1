<!DOCTYPE html>
<meta charset="utf-8"/>
<html>
    <!-- <head>
        <title>Supervisor Portal</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">   
        <link rel="stylesheet" href="LOTR.css" type="text/css" charset="utf-8" />
    </head> -->
    <body>
        <div id="topBar" class="container" style="margin-top: 10px">
            <table width=100%>
                <tr>
                    <td><h3>Supervisor Portal</h3></td>
                    <td >
                        <div>
                            <button id="approveBtn">Approve</button>
                            <button id="rejectBtn">Reject</button>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div id="mainArea" class="container">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Submitted By</th>
                        <th>Description</th>
                        <th>Amount</th>
                        <th>Submitted On</th>
                        <th>Status</th>
                        <th>Proccessed By</th>
                        <th>Comments</th>
                    </tr>
                </thead>
                <tbody id="itemsTable">
                </tbody>
            </table>
        </div>
    </body>
    <!-- <script>
        let table = document.getElementById('itemsTable'); 

        let approve = function(){
            // let outData;
            // let selected = table.getElementsByClassName('selected');
            // if(!(selected.length===0)){ //check that a row is selected
            //     let row = selected[0];
            //     if(row.children[7].children[0]){ //check that this is a row that is pending
            //         let r_id = row.children[0].innerHTML;
            //         let manager = "name goes here";
            //         let string = row.children[7].children[0].value;
            //         outData = {
            //             id:r_id,
            //             approver:manager,
            //             comment:string,
            //             status:1,
            //         }
            //         updateRow(JSON.stringify(outData));
            //     }
            // }
            let reimbursement = getRowData(id);

            let xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function(){
                if(this.readyState === 4 && this.status === 200){
                    getAndUpdateById(id);
                }
            }
            xhttp.open("post", "http://localhost:8080/Project1_WebApp/accept.do", true);
            xhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
            xhttp.send(`reimbursement=${reimbursement}&comment=${reimbursement.comment}`);
        }

        let reject = function(id){
            let reimbursement = getRowData(id);

            let xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function(){
                if(this.readyState === 4 && this.status === 200){
                    getAndUpdateById(id);
                }
            }
            xhttp.open("post", "http://localhost:8080/Project1_WebApp/reject.do", true);
            xhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
            xhttp.send(`reimbursement=${reimbursement}&comment=${reimbursement.comment}`);
        }

        function getRowData(id){
            let rows = Array.prototype.slice.call(table.getElementsByTagName('tr'));
            rows.forEach(row => {
                if(row.children[0].innerHTML==id){

                    let outObject;

                    outObject.id=id;
                    outObject.submitter=row.children[1].innerHTML;
                    outObject.description=row.children[2].innerHTML;
                    outObject.amount=row.children[3].innerHTML;
                    outObject.timestamp=row.children[4].innerHTML;
                    switch(row.children[5].innerHTML){
                        case 'Approved': outObject.status=1; break;
                        case 'Rejected': outObject.status=2; break;
                        case 'Pending': outObject.status=0; break;
                    }                    
                    outObject.approver=row.children[6].innerHTML;
                    if(row.children[7].children[2]){
                        outObject.comment=row.children[7].children[2].value;
                    } else{
                        outObject.comment=row.children[7].innerHTML;
                    }

                    return JSON.stringify(outObject);
                }
            });
        }

        function addRow(dataJSON){

            let data = JSON.parse(dataJSON);

            let string = `<tr>`;
                string+= `<td>${data.id}</td>`;
                string+= `<td>${data.submitter}</td>`;
                string+= `<td>${data.description}</td>`;
                string+= `<td>${data.amount}</td>`;
                string+= `<td>${data.timestamp}</td>`;
                if(data.status===1){
                    string+= `<td>Approved</td>`;
                }else if(data.status===2){
                    string+= `<td>Rejected</td>`;
                }else{
                    string+= `<td>Pending</td>`;
                }
                string+= `<td>${data.approver}</td>`;
                if(data.status===0){
                    string+= `<td>
                                <button onclick='approve(${data.id})'>A</button>
                                <button onclick='reject(${data.id})'>R</button>
                                <input type='text'>
                             </td>`;
                }else{
                    string+= `<td>${data.comment}</td>`;
                }
                string+= `</tr>`;
            table.innerHTML+=string;
        }

        function updateRow(dataJSON){
            let data = JSON.parse(dataJSON);

            let rows = Array.prototype.slice.call(table.getElementsByTagName('tr'));
            rows.forEach(row => {
                if(row.children[0].innerHTML===data.id){
                    if(data.status===1){
                        row.children[5].innerHTML="Approved";
                    }else if(data.status===2){
                        row.children[5].innerHTML="Rejected";
                    }else{
                        row.children[5].innerHTML="Pending";
                    }
                    
                    row.children[6].innerHTML=data.approver;
                    row.children[7].innerHTML=data.comment;
                }
            });
        }

        let getAndUpdateById = function(id){
            let xhttp = new XMLHttpRequest();

            xhttp.onreadystatechange = function(){
                if(this.readyState === 4 && this.status === 200){
                    updateRow(this.responseText);
                }
            }
            xhttp.open("post", "http://localhost:8080/Project1_WebApp/getReimbursementById.do", true);
            xhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
            xhttp.send(`r_id=${id}`);
        }

        let populateTable = function(){
            let xhttp = new XMLHttpRequest();

            xhttp.onreadystatechange = function(){
                if(this.readyState === 4 && this.status === 200){
                    let items = Json.parse(this.responseText);
                    items.forEach(element => {
                        addRow(JSON.stringify(element));
                    });                  
                }
            }
            xhttp.open("post", "http://localhost:8080/Project1_WebApp/getAllReimbursements.do", true);
            xhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
            xhttp.send();
        }

            
    </script> -->
</html>